<script>
// מזהה הגיליון
const sheetId = "14tuI-XR1uSI6_NKlVJCSitgrBN8ItKB_kl4b3KwWwp4";

// --- גיליון השמות והכיתות ---
const namesSheet = "Data"; // שנה לשם המדויק
const urlNames = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json&sheet=${namesSheet}`;
let dataRows = [];

// --- גיליון האירועים ---
const eventsSheet = "Events"; // שנה לשם המדויק
const urlEvents = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json&sheet=${eventsSheet}`;
let eventRows = [];

// קריאת שמות וכיתות
fetch(urlNames)
  .then(res => res.text())
  .then(data => {
    const json = JSON.parse(data.substr(47).slice(0, -2));
    dataRows = json.table.rows;
    const nameList = document.getElementById("nameList");
    dataRows.forEach(row => {
      if (row.c[0] && row.c[0].v) {
        let option = document.createElement("option");
        option.value = row.c[0].v; // שם בעמודה A
        nameList.appendChild(option);
      }
    });
  });

// קריאת אירועים
fetch(urlEvents)
  .then(res => res.text())
  .then(data => {
    const json = JSON.parse(data.substr(47).slice(0, -2));
    eventRows = json.table.rows;
    const eventList = document.getElementById("eventList");
    eventRows.forEach((row, index) => {
      if (index > 0 && row.c[0] && row.c[0].v) { // דילוג על הכותרת
        let option = document.createElement("option");
        option.value = row.c[0].v;
        eventList.appendChild(option);
      }
    });
  });

// בחירת שם → מילוי כיתה
document.getElementById("name").addEventListener("input", function() {
    const selectedName = this.value.trim();
    const row = dataRows.find(r => r.c[0] && r.c[0].v.trim() === selectedName);
    if (row) {
        document.getElementById("class").value = row.c[1]?.v || "";
    } else {
        document.getElementById("class").value = "";
    }
});

// שליחת הטופס לוובהוק
document.querySelector("form").addEventListener("submit", function(e) {
    e.preventDefault(); // מניעת שליחה רגילה
    const payload = {
        name: document.getElementById("name").value,
        class: document.getElementById("class").value,
        event: document.getElementById("event").value
    };

    fetch("https://your-webhook-url.com", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
    })
    .then(res => res.text())
    .then(response => {
        alert("הטופס נשלח בהצלחה!");
        console.log(response);
    })
    .catch(err => {
        alert("שגיאה בשליחה!");
        console.error(err);
    });
});
</script>
