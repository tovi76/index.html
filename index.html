<!DOCTYPE html>
<html lang="he">
<head>
    <meta charset="UTF-8">
    <title>טופס בחירה</title>
    <style>
        body { font-family: Arial, sans-serif; direction: rtl; }
        label { display: block; margin-top: 10px; }
        select, button { padding: 5px; margin-top: 5px; }
    </style>
</head>
<body>
    <h1>טופס בחירה</h1>

    <label>שם תלמיד:
        <select id="studentSelect">
            <option value="">בחר תלמיד</option>
        </select>
    </label>

    <label>כיתה:
        <input type="text" id="classInput" readonly>
    </label>

    <label>אירוע:
        <select id="eventSelect">
            <option value="">בחר אירוע</option>
        </select>
    </label>

    <button id="submitBtn">שלח</button>

    <p id="status"></p>

    <script>
        const sheetId = "14tuI-XR1uSI6_NKlVJCSitgrBN8ItKB_kl4b3KwWwp4";
        const studentUrl = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json&sheet=Data`;
        const eventsUrl = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json&sheet=Events`;

        const studentSelect = document.getElementById("studentSelect");
        const classInput = document.getElementById("classInput");
        const eventSelect = document.getElementById("eventSelect");
        const statusP = document.getElementById("status");

        // טעינת רשימת תלמידים
        fetch(studentUrl)
            .then(res => res.text())
            .then(text => {
                const json = JSON.parse(text.substr(47).slice(0, -2));
                const rows = json.table.rows;
                rows.forEach(row => {
                    const name = row.c[0]?.v || "";
                    const className = row.c[1]?.v || "";
                    if (name) {
                        const option = document.createElement("option");
                        option.value = className;
                        option.textContent = name;
                        studentSelect.appendChild(option);
                    }
                });
            })
            .catch(err => {
                statusP.textContent = "שגיאה בטעינת תלמידים: " + err;
            });

        // טעינת רשימת אירועים
        fetch(eventsUrl)
            .then(res => res.text())
            .then(text => {
                const json = JSON.parse(text.substr(47).slice(0, -2));
                const rows = json.table.rows;
                rows.forEach(row => {
                    const eventName = row.c[0]?.v || "";
                    if (eventName) {
                        const option = document.createElement("option");
                        option.textContent = eventName;
                        eventSelect.appendChild(option);
                    }
                });
            })
            .catch(err => {
                statusP.textContent = "שגיאה בטעינת אירועים: " + err;
            });

        // בעת בחירת תלמיד
        studentSelect.addEventListener("change", () => {
            classInput.value = studentSelect.value || "";
        });

        // שליחת וובהוק
        document.getElementById("submitBtn").addEventListener("click", () => {
            const selectedStudent = studentSelect.options[studentSelect.selectedIndex].text;
            const selectedClass = classInput.value;
            const selectedEvent = eventSelect.value;

            if (!selectedStudent || !selectedClass || !selectedEvent) {
                statusP.textContent = "יש למלא את כל השדות.";
                return;
            }

            fetch("YOUR_WEBHOOK_URL", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    student: selectedStudent,
                    class: selectedClass,
                    event: selectedEvent
                })
            })
            .then(() => {
                statusP.textContent = "הטופס נשלח בהצלחה!";
            })
            .catch(err => {
                statusP.textContent = "שגיאה בשליחה: " + err;
            });
        });
    </script>
</body>
</html>
