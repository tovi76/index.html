<!DOCTYPE html>
<html lang="he">
<head>
<meta charset="UTF-8">
<title>טופס בחירת שם, כיתה ואירוע</title>
<style>
  body {
    font-family: Arial, sans-serif;
    direction: rtl;
    margin: 20px;
    background-color: #f5f5f5;
  }
  form {
    background: white;
    padding: 20px;
    border-radius: 10px;
    max-width: 400px;
  }
  label {
    display: block;
    margin-top: 10px;
    font-weight: bold;
  }
  input, button {
    width: 100%;
    padding: 8px;
    margin-top: 5px;
    box-sizing: border-box;
  }
  button {
    background: #4CAF50;
    color: white;
    border: none;
    cursor: pointer;
    font-size: 16px;
    margin-top: 15px;
  }
  button:hover {
    background: #45a049;
  }
</style>
</head>
<body>

<h2>טופס שליחת נתונים</h2>

<form id="myForm">
  <label for="name">שם:</label>
  <input list="nameList" id="name" name="name" placeholder="בחר שם...">
  <datalist id="nameList"></datalist>

  <label for="class">כיתה:</label>
  <input type="text" id="class" name="class" readonly placeholder="הכיתה תופיע כאן">

  <label for="event">האירוע:</label>
  <input list="eventList" id="event" name="event" placeholder="בחר אירוע...">
  <datalist id="eventList"></datalist>

  <button type="submit">שלח</button>
</form>

<script>
// מזהה הגיליון שלך
const sheetId = "14tuI-XR1uSI6_NKlVJCSitgrBN8ItKB_kl4b3KwWwp4";

// --- גיליון השמות והכיתות ---
const namesSheet = "Data"; // שנה לשם המדויק
const urlNames = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json&sheet=${namesSheet}`;
let dataRows = [];

// --- גיליון האירועים ---
const eventsSheet = "Events"; // שנה לשם המדויק
const urlEvents = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json&sheet=${eventsSheet}`;
let eventRows = [];

// קריאת שמות וכיתות
fetch(urlNames)
  .then(res => res.text())
  .then(data => {
    const json = JSON.parse(data.substr(47).slice(0, -2));
    dataRows = json.table.rows;
    const nameList = document.getElementById("nameList");
    dataRows.forEach(row => {
      if (row.c[0] && row.c[0].v) {
        let option = document.createElement("option");
        option.value = row.c[0].v; // שם בעמודה A
        nameList.appendChild(option);
      }
    });
  });

// קריאת אירועים
fetch(urlEvents)
  .then(res => res.text())
  .then(data => {
    const json = JSON.parse(data.substr(47).slice(0, -2));
    eventRows = json.table.rows;
    const eventList = document.getElementById("eventList");
    eventRows.forEach((row, index) => {
      if (index > 0 && row.c[0] && row.c[0].v) { // דילוג על הכותרת
        let option = document.createElement("option");
        option.value = row.c[0].v;
        eventList.appendChild(option);
      }
    });
  });

// בחירת שם → מילוי כיתה
document.getElementById("name").addEventListener("input", function() {
    const selectedName = this.value.trim();
    const row = dataRows.find(r => r.c[0] && r.c[0].v.trim() === selectedName);
    if (row) {
        document.getElementById("class").value = row.c[1]?.v || "";
    } else {
        document.getElementById("class").value = "";
    }
});

// שליחת הטופס לוובהוק
document.getElementById("myForm").addEventListener("submit", function(e) {
    e.preventDefault(); // מניעת שליחה רגילה
    const payload = {
        name: document.getElementById("name").value,
        class: document.getElementById("class").value,
        event: document.getElementById("event").value
    };

    fetch("https://your-webhook-url.com", { // החלף בכתובת הוובהוק שלך
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
    })
    .then(res => res.text())
    .then(response => {
        alert("הטופס נשלח בהצלחה!");
        console.log("Webhook Response:", response);
    })
    .catch(err => {
        alert("שגיאה בשליחה!");
        console.error(err);
    });
});
</script>

</body>
</html>
